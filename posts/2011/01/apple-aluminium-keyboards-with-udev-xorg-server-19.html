<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        

        <title>Apple Aluminium Keyboards with udev, Xorg server 1.9</title>

        <link href="https://dciabrin.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="(blog-dump 'dciabrin) Full Atom Feed" />
        <link href="https://dciabrin.net/feeds/apple-kbd.tag.atom.xml" type="application/atom+xml" rel="alternate" title="(blog-dump 'dciabrin) Tags Atom Feed" />
        <link href="https://dciabrin.net/feeds/apple.tag.atom.xml" type="application/atom+xml" rel="alternate" title="(blog-dump 'dciabrin) Tags Atom Feed" />


        <!-- Blog theme + Bootstrap compiled to CSS -->
        <link rel="stylesheet" href="https://dciabrin.net/theme/css/blogtheme.css?6f5403ff">

        <!-- Code highlight color scheme -->
            <link href="https://dciabrin.net/theme/css/code_blocks/friendly.css" rel="stylesheet">

        <!--  -->

        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">



        <meta name="description" content="It's been a year now since I published my support for Aluminium Keyboards. Since then, my XKB patches have been accepted in...">

        <meta name="author" content="Damien Ciabrini">

        <meta name="tags" content="apple-kbd">
        <meta name="tags" content="apple">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="(blog-dump 'dciabrin)">

	<meta property="og:type" content="article">
            <meta property="article:author" content="https://dciabrin.net/author/damien-ciabrini.html">
	<meta property="og:url" content="https://dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html">
	<meta property="og:title" content="Apple Aluminium Keyboards with udev, Xorg server 1.9">
	<meta property="article:published_time" content="2011-01-11 22:48:00.004000+01:00">
            <meta property="og:description" content="It's been a year now since I published my support for Aluminium Keyboards. Since then, my XKB patches have been accepted in...">

            <meta property="og:image" content="https://dciabrin.net/img/covers/big-dodzy-59J9tB7KoOU-unsplash.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@dciabrin">
        <meta name="twitter:title" content="Apple Aluminium Keyboards with udev, Xorg server 1.9">

            <meta name="twitter:image" content="https://dciabrin.net/theme/images/post-bg.jpg">

            <meta name="twitter:description" content="It's been a year now since I published my support for Aluminium Keyboards. Since then, my XKB patches have been accepted in...">
    <link rel="icon" href="/favicon.ico">
</head>

<body class="article-apple-aluminium-keyboards-with-udev-xorg-server-19">

    <!-- Navigation -->
    <nav class="navbar navbar-light navbar-expand-lg navbar-customz navbar-fixed-topz">
        <!-- <div class="container-fluid"> -->
            <!-- Brand and toggle get grouped for better mobile display -->
            <!-- <div class="navbar-header page-scroll"> -->
                <a class="navbar-brand" href="https://dciabrin.net/">(blog-dump 'dciabrin)</a>
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="navbar-toggler-icon"></span>
                </button>
            <!-- </div> -->

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="navbar-nav flex-row ml-md-auto d-md-flex">

                            <li><a class="nav-link" href="https://dciabrin.net/pages/about.html">About</a></li>
                </ul>
                <ul class="navbar-nav">
                  <li><a class="nav-link" href="#"><i class="fa fa-search"></i></a></li>
                  <li><a class="nav-link" href="/tags"><i class="fa fa-tags"></i></a></li>
                  <li><a class="nav-link" href="#"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        <!-- </div> -->
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <header class="intro-header">
        <div id="header-background" style="background-image: url('https://dciabrin.net/img/covers/alex-knight-Ys-DBJeX0nE-unsplash.jpg'); --parallax-ratio: 1.500;">
        </div>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
                    <div class="post-heading">
                        <!-- <i class="fa fa-calendar" aria-hidden="true"></i>&nbsp; -->
                        <span class="text-light meta">Tue 11 January 2011</span>
                        <h1 class="text-light">Apple Aluminium Keyboards with udev, Xorg server 1.9</h1>
                        <span class="meta">
                          &nbsp;
                          <a class="btn btn-outline-secondary btn-sm" href="https://dciabrin.net/tag/apple-kbd.html"><i class="fa fa-tag" aria-hidden="true"></i> APPLE-KBD</a>
&nbsp;                          <a class="btn btn-outline-secondary btn-sm" href="https://dciabrin.net/tag/apple.html"><i class="fa fa-tag" aria-hidden="true"></i> APPLE</a>
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container-fluid">
    <!-- Post Content -->
    <div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">
        <article>
            <p>It's been a year now since I published my support for Aluminium
Keyboards. Since then, my XKB patches have been accepted in
<a href="http://freedesktop.org/wiki/Software/XKeyboardConfig">XKeyboardConfig</a>
1.9, with a few modifications:</p>
<ul>
<li>
<p>The multimedia keys can always be accessed by combining Fxx with the
    3rd level chooser (this was option <code id="tt1099">alul3media</code> in my
    original XKB patches)</p>
</li>
<li>
<p>There is now a single XKB option <code id="tt1101">alupckeys</code> to emulate the
    behaviour of a PC keyboard, <em>i.e.</em> to enable PrintScreen,
    ScrollLock, SysReq and NumLock (options <code id="tt1103">alupcfkeys</code> and
    <code id="tt1104">alupcnumlock</code> in the original patches)</p>
</li>
</ul>
<!-- PELICAN_END_SUMMARY -->

<p>Meanwhile, Xorg server 1.9 went stable, becoming more and more
pervasive. As far as input hotplugging is concerned, this is a major
revision for it dropped
<a href="http://www.freedesktop.org/wiki/Software/hal">HAL</a> in favor of
<a href="http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html">udev</a>:
input discovery is achieved via udev and XKB settings for devices are
fetched from the udev database.</p>
<p>I have thus ported the support for the Aluminium Keyboards to udev. As
before, a configuration file controls the XKB settings to apply, as well
as the remapping of the "fn" key to "insert", if requested.</p>
<h2>Installing the udev-enabled support</h2>
<p>First, download the <a href="http://damien.ciabrini.free.fr/pub/alu-kbd-udev/95-keymap-apple-kdb.rules">necessary udev
rules</a>
and install them in whatever directory your distrib uses to store user
rules. On Ubuntu, assuming that you downloaded the rules in your home
directory, this gives:</p>
<div class="highlight"><pre><span></span><code><span class="go">sudo cp $HOME/95-keymap-apple-kdb.rules /etc/udev/rules.d</span>
</code></pre></div>


<p>Then, download the <a href="http://damien.ciabrini.free.fr/pub/alu-kbd-udev/apple-kbd">configuration
file</a> and
install it in your distrib's configuration directory. On Ubuntu, this
gives:</p>
<div class="highlight"><pre><span></span><code><span class="go">sudo cp $HOME/apple-kbd /etc/default</span>
</code></pre></div>


<p>The configuration file contains various key-value pairs that drive the
behaviour of the Aluminium Keyboard. By default, the configuration
enables the XKB option for PC-like mapping (PrintScreen, ScrollLock,
Pause, NumLock) and maps the "fn" key to "insert". Comment out the
relevant lines to disable any of those settings if necessary.</p>
<h2>There's a catch: what's your distrib?</h2>
<p>The udev-enabled support assumes one thing: that you are running
xkeyboard-config 1.9 or above. Not all distribs are equal in this
regard.</p>
<p>A quick search shows that Arch, Gentoo, Fedora or openSUSE all ship a
recent-enough xkeyboard-config. On the other hand, Debian is currently
stuck with xkeyboard-config 1.8-2 (at least for unstable, I haven't
checked experimental).</p>
<p>The Ubuntu case is the most puzzling one. At the time of writing,
Maverick and Natty ship xkeyboard-config 1.8-1ubuntu8, which is based on
1.8 stock plus additional important commits from the git repository.
This includes my patches for the Aluminium Keyboard (!), but
unfortunately only 6 patches out of 7 have been included (!?!).
Consequently, the XKB support is currently broken for Ubuntu. I have
filled <a href="https://bugs.launchpad.net/bugs/696232">bug 696232</a> in Launchpad
to track this issue and check whether this was intended or not.
Meanwhile, you can grab <a href="http://damien.ciabrini.free.fr/pub/alu-kbd-udev/xkb-data-1.8-evdev.patch">this XKB
patch</a>
and try to apply it:</p>
<div class="highlight"><pre><span></span><code><span class="go">sudo bash</span>
<span class="go">cd /usr/share/X11/xkb/rules</span>
<span class="go">patch -p0 --dry-run &lt; $HOME/xkb-data-1.8-evdev.patch</span>
</code></pre></div>


<p>If the patch applies successfully, you can proceed and apply it for
real:</p>
<div class="highlight"><pre><span></span><code><span class="go">patch -p0 &lt; $HOME/xkb-data-1.8-evdev.patch</span>
</code></pre></div>


<h2>Steps to come</h2>
<p>With this updated support, Aluminium Keyboards work again under recent
versions of the Xorg server, but there are still various improvements to
think about. The next step is to package the support to make it more
user-friendly. A package is definitely a good place to deal with other
keyboard options, such as kernel settings for activating multimedia keys
<em>vs.</em> function keys.</p>
<p>On the XKB side, it would be necessary to perform a second pass to
ensure that there are no missing or misplaced symbols on the 16 existing
keymaps: ANSI, JIS and the 14 ISO layouts.</p>
<p>Speaking of misplaced symbols: I am currently checking whether it's
possible to come with a fully user-space, udev-based solution to the
<a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/214786">"keys swapped"
issue</a> that
plague some owners of the ISO variants. I have some ideas, but this will
be another post!</p>
        </article>
    </div>
    </div>

    <div class="sharing row justify-content-center">
      <div class="col text-center">
        <span class="meta text-uppercase share">share</span>
        <a href="https://twitter.com/intent/tweet?text=Apple%20Aluminium%20Keyboards%20with%20udev%2C%20Xorg%20server%201.9&url=https%3A//dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html&hashtags=apple-kbd,apple" target="_blank"><i class="fa fa-twitter-square" aria-hidden="true"></i></a>
        <a href="https://www.reddit.com/submit?url=https%3A//dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html&title=Apple%20Aluminium%20Keyboards%20with%20udev%2C%20Xorg%20server%201.9" target="_blank"><i class="fa fa-reddit-square" aria-hidden="true"></i></a>
        <a href="https://news.ycombinator.com/submitlink?t=Apple%20Aluminium%20Keyboards%20with%20udev%2C%20Xorg%20server%201.9&u=https%3A//dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html" target="_blank"><i class="fa fa-y-combinator-square" aria-hidden="true"></i></a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html&title=Apple%20Aluminium%20Keyboards%20with%20udev%2C%20Xorg%20server%201.9&summary=It%27s%20been%20a%20year%20now%20since%20I%20published%20my%20support%20for%20Aluminium%0AKeyboards.%20Since%20then%2C%20my%20XKB%20patches%20have%20been%20accepted%20in%0AXKeyboardConfig%0A1.9%2C%20with%20a%20few%20modifications%3A%0A%0A%0AThe%20multimedia%20keys%20can%20always%20be%20accessed%20by%20combining%20Fxx%20with%20the%0A%20%20%20%203rd%20level%20chooser%20%28this%20was%20option%20alul3media%20in%20my%20%E2%80%A6&source=https%3A//dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html" target="_blank"><i class="fa fa-linkedin-square" aria-hidden="true"></i></a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html" target="_blank"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
        <a href="mailto:?subject=Apple%20Aluminium%20Keyboards%20with%20udev%2C%20Xorg%20server%201.9&amp;body=https%3A//dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html" target="_blank"><i class="fa fa-envelope-square" aria-hidden="true"></i></a>
      </div>
    </div>
    <hr />

<!--  -->
<nav class="nav-articles row justify-content-center">
    <div class="col-lg-10 col-md-12">
    <div class="row justify-content-center">
        <div class="col newer-article text-left">
            <div>Newer Post</div>
            <a aria-label="Previous" href="https://dciabrin.net/posts/2011/05/support-for-aluminium-keyboards-packaged-code-named-apple-kbd.html">
              Support for Aluminium Keyboards packaged, code-named apple-kbd
            </a>
        </div>
        <div class="col text-center">
        </div>
        <div class="col older-article text-right">
            <div>Older Post</div>
            <a aria-label="Next" href="https://dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html">
              Aluminium Keyboard support under X11: all models, all OSes
            </a>
        </div>
    </div>
    </div>
</nav>
<!--  -->
    </div>

    <!-- <hr> -->

    <!-- Footer -->
    <footer>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
<p class="text-center copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  Damien Ciabrini
  <br />
      <span class="fa-stack fa">
      <a href="http://twitter.com/dciabrin">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </a>
      </span>
      <span class="fa-stack fa">
      <a href="http://github.com/dciabrin">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </a>
      </span>
      <span class="fa-stack fa">
      <a href="https://www.linkedin.com/in/damien-ciabrini-70514187">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
      </a>
      </span>
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://dciabrin.net/theme/js/jquery.min.js"></script>

    <!-- Parallax -->
    <script src="https://dciabrin.net/theme/js/parallax.js?nocache"></script>
    <script>
      parallax('header-background');
    </script> 

    <!-- Bootstrap Core JavaScript -->
    <script src="https://dciabrin.net/theme/js/bootstrap.min.js"></script>

</body>

</html>