<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        

        <title>Aluminium Keyboard support under X11: all models, all OSes</title>

        <link href="https://dciabrin.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="(blog-dump 'dciabrin) Full Atom Feed" />
        <link href="https://dciabrin.net/feeds/apple-kbd.tag.atom.xml" type="application/atom+xml" rel="alternate" title="(blog-dump 'dciabrin) Tags Atom Feed" />
        <link href="https://dciabrin.net/feeds/apple.tag.atom.xml" type="application/atom+xml" rel="alternate" title="(blog-dump 'dciabrin) Tags Atom Feed" />


        <!-- Blog theme + Bootstrap compiled to CSS -->
        <link rel="stylesheet" media="screen" href="https://dciabrin.net/theme/css/blogtheme.css?e57e5b1e">

        <!-- Blog theme + Bootstrap compiled to CSS -->
        <link rel="stylesheet" media="print" href="https://dciabrin.net/theme/css/blogprint.css?e9236b24">

        <!-- Code highlight color scheme -->
            <link href="https://dciabrin.net/theme/css/code_blocks/friendly.css" media="screen" rel="stylesheet">
            <link href="https://dciabrin.net/theme/css/code_blocks/bw.css?fw" media="print" rel="stylesheet">

        <!--  -->

        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

        <!-- jQuery -->
        <script src="https://dciabrin.net/theme/js/jquery.min.js"></script>

        <!-- Parallax -->
        <script src="https://dciabrin.net/theme/js/parallax.js?nocache"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://dciabrin.net/theme/js/bootstrap.min.js"></script>




        <meta name="description" content="I finally found the time to update my previous support for Aluminium Keyboard under Xorg, and take it to the Next Level (tm). The...">

        <meta name="author" content="Damien Ciabrini">

        <meta name="tags" content="apple-kbd">
        <meta name="tags" content="apple">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="(blog-dump 'dciabrin)">

	<meta property="og:type" content="article">
            <meta property="article:author" content="https://dciabrin.net/author/damien-ciabrini.html">
	<meta property="og:url" content="https://dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html">
	<meta property="og:title" content="Aluminium Keyboard support under X11: all models, all OSes">
	<meta property="article:published_time" content="2009-12-22 22:03:00.008000+01:00">
            <meta property="og:description" content="I finally found the time to update my previous support for Aluminium Keyboard under Xorg, and take it to the Next Level (tm). The...">

            <meta property="og:image" content="https://dciabrin.net/img/covers/big-dodzy-59J9tB7KoOU-unsplash.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@dciabrin">
        <meta name="twitter:title" content="Aluminium Keyboard support under X11: all models, all OSes">

            <meta name="twitter:image" content="https://dciabrin.net/theme/images/post-bg.jpg">

            <meta name="twitter:description" content="I finally found the time to update my previous support for Aluminium Keyboard under Xorg, and take it to the Next Level (tm). The...">
    <link rel="icon" href="/favicon.ico">
</head>

<body class="article-aluminium-keyboard-support-under-x11-all-models-all-oses">

    <!-- Navigation -->
    <nav class="navbar d-print-none navbar-light navbar-expand-lg navbar-customz navbar-fixed-topz">
        <!-- <div class="container-fluid"> -->
            <!-- Brand and toggle get grouped for better mobile display -->
            <!-- <div class="navbar-header page-scroll"> -->
                <a class="navbar-brand" href="https://dciabrin.net/">(blog-dump 'dciabrin)</a>
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="navbar-toggler-icon"></span>
                </button>
            <!-- </div> -->

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="navbar-nav flex-row ml-md-auto d-md-flex">

                            <li><a class="nav-link" href="https://dciabrin.net/pages/about.html">About</a></li>
                </ul>
                <ul class="navbar-nav">
                  <li><a class="nav-link" href="https://dciabrin.net/search.html"><i class="fa fa-search"></i></a></li>
                  <li><a class="nav-link" href="https://dciabrin.net/tags.html"><i class="fa fa-tags"></i></a></li>
                  <li><a class="nav-link" href="#"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        <!-- </div> -->
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <header class="intro-header">
        <div id="header-background" style="background-image: url('https://dciabrin.net/img/covers/alex-knight-Ys-DBJeX0nE-unsplash.jpg'); --parallax-ratio: 1.500; background-color: #072A36;">
        </div>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
                    <div class="post-heading">
                        <span class="text-light meta">Tue 22 December 2009</span>
                        <h1 class="text-light">Aluminium Keyboard support under X11: all models, all OSes</h1>
                            <a class="d-none d-print-block author" rel="author">Damien Ciabrini</a>
                        <span class="meta d-print-none">
                          &nbsp;
                          <a class="btn btn-outline-secondary btn-sm" href="https://dciabrin.net/tag/apple-kbd.html"><i class="fa fa-tag" aria-hidden="true"></i> APPLE-KBD</a>
&nbsp;                          <a class="btn btn-outline-secondary btn-sm" href="https://dciabrin.net/tag/apple.html"><i class="fa fa-tag" aria-hidden="true"></i> APPLE</a>
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container-fluid">
    <!-- Post Content -->
    <div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">
        <article>
          <p>I finally found the time to update my previous support for Aluminium
Keyboard under Xorg, and take it to the Next Level (tm). The overall
support is now much more polished. For you this means several things:</p>
<ul>
<li>
<p>I've implemented the XKB geometries of <strong>all variants of the long
    Aluminium Keyboard</strong>, be it
    <a href="http://damien.ciabrini.free.fr/pub/applekbd-xkb/apple-alukbd-ansi.svg">ANSI</a>
    (American),
    <a href="http://damien.ciabrini.free.fr/pub/applekbd-xkb/apple-alukbd-iso.svg">ISO</a>
    (Internationnal) or
    <a href="http://damien.ciabrini.free.fr/pub/applekbd-xkb/apple-alukbd-jis.svg">JIS</a>
    (Japanese)! And believe me, it's darned complicated to support JIS
    keyboard's dual layout without having access to the real hardware :D</p>
</li>
<li>
<p>I've added support for base XKB rules, which means that the keyboard
    will now be properly configured <strong>on other OSes than Linux</strong>. I
    personally used <a href="http://www.opensolaris.org/">OpenSolaris</a> during my
    tests, but it should work equally well on
    <a href="http://www.freebsd.org/">FreeBSD</a>, <a href="http://openbsd.org/">OpenBSD</a>,
    and all their cousins!</p>
</li>
<li>
<p>The keyboard support is now <strong>aware of the system-wide keyboard
    settings</strong> as found in Debian or Fedora for example. If you
    configured your system to default to Dvorak layout, the support will
    use it automatically!</p>
</li>
</ul>
<!-- PELICAN_END_SUMMARY -->

<h2>Installing the new support</h2>
<p>I'm short on details, but you can find a complete explanation for all
these steps in a <a href="http://damienciabrini.blogspot.com/2009/05/make-your-apple-aluminium-keyboard.html">previous
post</a>.</p>
<h3>XKB Patch</h3>
<p>First of all, download <a href="http://damien.ciabrini.free.fr/pub/applekbd-xkb/applekbd-xkb-support.patch.gz">this XKB
patch</a>
and try to apply it on your XKB install in dry-run. For the sake of the
example, I assume you downloaded the patch in your <code>$HOME</code> directory.</p>
<div class="highlight"><pre><span></span><code><span class="go">sudo bash</span>
<span class="go">cd /usr/share/X11/xkb</span>
<span class="go">gunzip -cd $HOME/applekbd-xkb-support.patch.gz | patch -p1 --dry-run</span>
</code></pre></div>


<p>If the patch applies successfuly, you can proceed and apply it for real:</p>
<div class="highlight"><pre><span></span><code><span class="go">gunzip -cd $HOME/applekbd-xkb-support.patch.gz | patch -p1</span>
</code></pre></div>


<h3>HAL support</h3>
<p>Well, even if HAL is meant to be replaced sooner or later by
<a href="http://fedoraproject.org/wiki/Features/DeviceKit">DeviceKit</a>, that's
the way to go for the time being. So I reworked the previous HAL support
and split it in one fdi file to track your keyboard on your hardware,
plus a script to configure XKB for Aluminium Keyboard and to remap the
Fn key to Insert. To install it, first remove the fdi file from the
previous support if necessary. Then, copy this <a href="http://damien.ciabrini.free.fr/pub/applekbd-xkb/10-applekbd-xkb-settings.fdi">new fdi
file</a>
(which you have previously downloaded in your <code>$HOME</code> directory) in the
relevant HAL directory. On my Ubuntu Karmic, this gives (<strong>update:</strong>
added missing chmod, thanks Patrick):</p>
<div class="highlight"><pre><span></span><code><span class="go">sudo bash</span>
<span class="go">rm -f /usr/share/hal/fdi/policy/30user/10-apple-aluminium-kbd.fdi</span>
<span class="go">mkdir -p /usr/share/hal/fdi/policy/30user</span>
<span class="go">cp $HOME/10-applekbd-xkb-settings.fdi /usr/share/hal/fdi/policy/30user</span>
</code></pre></div>


<p>Download (I assume in your <code>$HOME</code> directory) the <a href="http://damien.ciabrini.free.fr/pub/applekbd-xkb/applekbd-xkb-settings.sh">new script for XKB
setting</a>,
plus its associated <a href="http://damien.ciabrini.free.fr/pub/applekbd-xkb/applekbd-xkb-settings">configuration
file</a>.
Then copy them respectively in HAL's installation directory and in the
system-wide configuration directory. On my Ubuntu, ths gives:</p>
<div class="highlight"><pre><span></span><code><span class="go">sudo bash</span>
<span class="go">cp $HOME/applekbd-xkb-settings.sh /usr/lib/hal</span>
<span class="go">chmod +x /usr/lib/hal/applekbd-xkb-settings.sh</span>
<span class="go">cp $HOME/applekbd-xkb-settings /etc/default</span>
</code></pre></div>


<p>You can tweak the configuration file
<code>/etc/default/applekbd-xkb-settings</code> to enable the settings you want for
your keyboard. By default, the Fn key is remapped to Insert. The XKB
options can be configured there for system-wide setting, as explained in
the configuration file itself. But it's more user-friendly to configure
XKB in your preferred Desktop Environment (GNOME, KDE, XFCE...
whatever).</p>
<h2>Enjoy!</h2>
<p>I'm particularly happy with my revised XKB geometries. A tedious work,
but this time keys dimension and layout perfectly match the original
hardware, whatever the model. I'm even more happy now that I discovered
how Apple decided to implement their EISU and KANA keys on the JIS
keyboard! If you are curious, have a look at file
<code>xkb/keycodes/machintosh</code> in the patch, or read <a href="http://forum.parallels.com/showthread.php?t=90313">this post on Parallels'
forum</a>.</p>
<p>The XKB patches are now ready for submission to the Xorg people
(xkeyboard-config). The rest of the files are also clean enough to start
providing .deb packages for this support! Maybe a good opportunity of
learning <a href="https://help.launchpad.net/Packaging/PPA">PPA</a> in
<a href="https://launchpad.net/">LaunchPad</a> :P</p>
          <h2 class="d-none d-print-block">References</h2>
          <table class="print_refs d-none d-print-block">
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_1">1</a>]</td><td class="print_ref"><p>http://damien.ciabrini.free.fr/pub/applekbd-xkb/apple-alukbd-ansi.svg</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_2">2</a>]</td><td class="print_ref"><p>http://damien.ciabrini.free.fr/pub/applekbd-xkb/apple-alukbd-iso.svg</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_3">3</a>]</td><td class="print_ref"><p>http://damien.ciabrini.free.fr/pub/applekbd-xkb/apple-alukbd-jis.svg</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_4">4</a>]</td><td class="print_ref"><p>http://www.opensolaris.org/</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_5">5</a>]</td><td class="print_ref"><p>http://www.freebsd.org/</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_6">6</a>]</td><td class="print_ref"><p>http://openbsd.org/</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_7">7</a>]</td><td class="print_ref"><p>http://fedoraproject.org/wiki/Features/DeviceKit</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_8">8</a>]</td><td class="print_ref"><p>https://help.launchpad.net/Packaging/PPA</p></td>
            </tr>
            <tr>
              <td class="print_ref_id">[<a id="prt_ref_9">9</a>]</td><td class="print_ref"><p>https://launchpad.net/</p></td>
            </tr>
          </table>
        </article>
    </div>
    </div>

    <div class="sharing d-print-none row justify-content-center">
      <div class="col text-center">
        <span class="meta text-uppercase share">share</span>
        <a href="https://twitter.com/intent/tweet?text=Aluminium%20Keyboard%20support%20under%20X11%3A%20all%20models%2C%20all%20OSes&url=https%3A//dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html&hashtags=apple-kbd,apple" target="_blank"><i class="fa fa-twitter-square" aria-hidden="true"></i></a>
        <a href="https://www.reddit.com/submit?url=https%3A//dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html&title=Aluminium%20Keyboard%20support%20under%20X11%3A%20all%20models%2C%20all%20OSes" target="_blank"><i class="fa fa-reddit-square" aria-hidden="true"></i></a>
        <a href="https://news.ycombinator.com/submitlink?t=Aluminium%20Keyboard%20support%20under%20X11%3A%20all%20models%2C%20all%20OSes&u=https%3A//dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html" target="_blank"><i class="fa fa-y-combinator-square" aria-hidden="true"></i></a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html&title=Aluminium%20Keyboard%20support%20under%20X11%3A%20all%20models%2C%20all%20OSes&summary=I%20finally%20found%20the%20time%20to%20update%20my%20previous%20support%20for%20Aluminium%0AKeyboard%20under%20Xorg%2C%20and%20take%20it%20to%20the%20Next%20Level%20%28tm%29.%20The%20overall%0Asupport%20is%20now%20much%20more%20polished.%20For%20you%20this%20means%20several%20things%3A%0A%0A%0AI%27ve%20implemented%20the%20XKB%20geometries%20of%20all%20variants%20of%20the%20long%0A%20%20%20%20Aluminium%20Keyboard%20%E2%80%A6&source=https%3A//dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html" target="_blank"><i class="fa fa-linkedin-square" aria-hidden="true"></i></a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html" target="_blank"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
        <a href="mailto:?subject=Aluminium%20Keyboard%20support%20under%20X11%3A%20all%20models%2C%20all%20OSes&amp;body=https%3A//dciabrin.net/posts/2009/12/aluminium-keyboard-support-under-x11-all-models-all-oses.html" target="_blank"><i class="fa fa-envelope-square" aria-hidden="true"></i></a>
      </div>
    </div>
    <hr class="d-print-none" />

<!--  -->
<nav class="nav-articles d-print-none row justify-content-center">
    <div class="col-lg-10 col-md-12">
    <div class="row justify-content-center">
        <div class="col newer-article text-left">
            <div>Newer Post</div>
            <a aria-label="Previous" href="https://dciabrin.net/posts/2011/01/apple-aluminium-keyboards-with-udev-xorg-server-19.html">
              Apple Aluminium Keyboards with udev, Xorg server 1.9
            </a>
        </div>
        <div class="col text-center">
        </div>
        <div class="col older-article text-right">
            <div>Older Post</div>
            <a aria-label="Next" href="https://dciabrin.net/posts/2009/05/make-your-apple-aluminium-keyboard-really-work-under-linux-xorg.html">
              Make your Apple Aluminium Keyboard really work under Linux, X.org
            </a>
        </div>
    </div>
    </div>
</nav>
<!--  -->
    </div>

    <!-- <hr> -->

    <!-- Footer -->
    <footer class="d-print-none">
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
<p class="text-center copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  Damien Ciabrini
  <br />
      <span class="fa-stack fa">
      <a href="http://twitter.com/dciabrin">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </a>
      </span>
      <span class="fa-stack fa">
      <a href="http://github.com/dciabrin">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </a>
      </span>
      <span class="fa-stack fa">
      <a href="https://www.linkedin.com/in/damien-ciabrini-70514187">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
      </a>
      </span>
</p>                </div>
            </div>
        </div>
    </footer>

    <script>
      parallax('header-background');
    </script> 

</body>

</html>